---
title: "tickfat"
output: html_document
date: "2024-10-08"
---

```{r setup, include=FALSE}

#install packages
if (!require("tidyverse")) install.packages("tidyverse")
if (!require("googlesheets4")) install.packages("googlesheets4")
if (!require("janitor")) install.packages("janitor")
if (!require("lubridate")) install.packages("lubridate")
if (!require("readxl")) install.packages("readxl")
if (!require("MuMIn")) install.packages("MuMIn")
if (!require("MASS")) install.packages("MASS")
if (!require("pscl")) install.packages("pscl")
if (!require("ggokabeito")) install.packages("ggokabeito")
if (!require("remotes")) install.packages("remotes")
if (!require("animation")) install.packages("animation")
if (!require("cowsay")) install.packages("cowsay")
if (!require("survminer")) install.packages("survminer")
if(!require(devtools)) install.packages("devtools")

#manually turn these off after install
#devtools::install_github("kassambara/survminer", build_vignettes = FALSE)
#remotes::install_github("trobinj/trtools")

#set working directory to present directory
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()

#load libraries
library(tidyverse)
library(googlesheets4)
library(janitor)
library(lubridate)
library(readxl)
library(MuMIn)
library(MASS)
library(pscl)
library(ggokabeito)
library(animation)
library(cowsay)
library(survminer)

#for making reports
knitr::opts_chunk$set(echo = TRUE)
```
```{r import}
df_raw <- suppressWarnings(
  read_sheet(
    "https://docs.google.com/spreadsheets/d/1px-Ldt1EfCNNAWOFSrFH69v8FHLSb1imCDa9wuUgJCc/edit?usp=sharing", 
    sheet = "weigh_data"
    )
) |>
  clean_names()

df_raw <- as_tibble(df_raw)
```
```{r data wrangle}

#extracts 2nd digit into treatment variable
df_wrangled <- df_raw |> mutate(
  treatment = str_match(tick_id, "[A-Z]([0-9]).*")[,2]
)

```
```{r data calculations}

df_calc <- df_wrangled |>
  rowwise() |>
  mutate(
    dess_wt_mean = mean(c_across(starts_with("dess_wt")), na.rm = TRUE), 
    dess_wt_sd = sd(c_across(starts_with("dess_wt")), na.rm = TRUE), .after = dess_wt_4
  ) |>
   mutate(
    xt_wt_mean = mean(c_across(starts_with("xt_wt")), na.rm = TRUE), 
    xt_wt_sd = sd(c_across(starts_with("xt_wt")), na.rm = TRUE), .after = xt_wt_3
  ) |>
  mutate(
    body_fat_raw = dess_wt_mean-xt_wt_mean,
    pct_bf = body_fat_raw/dess_wt_mean, 
    )
  
```
```{r plots}

#survival plot
require("survival")
fit <- survfit(Surv(time, dead) ~ treatment, data = df_calc)
ggsurvplot(fit, data = df_calc)

#converted to barchart from fit object
tibble(time = fit$time, surv = fit$surv, treatment = c(0:5)) |>
  filter(time == 1) |>
  ggplot(
    aes(x = treatment, y = surv)
    ) +
  geom_bar(
    stat = "identity", 
    position = "dodge"
    ) +
  labs(
    title = "Percent survival at 4 wk",
    subtitle = "High to low humidity", 
    x = "humidity treatment", 
    y = "survival"
  )

#scatterplot of body fat proportion
scplot <- df_calc |>
  filter(dead == 0 & lost_legs == 0) |>
  ggplot(
    aes(x=treatment, y = pct_bf, color = sex_m_f)
  ) +
  geom_point(
    position = position_dodge(width = 0.5), 
    size = 1
    ) +
  labs(
    title = "Body Fat Proportion",
    x = "humidity treatment", 
    y = "percent body fat",
  ) +
  theme_classic()
scplot

#barplot of body fat proportion
bplot <- df_calc |>
filter(dead == 0 & lost_legs == 0) |>
  ggplot(
    aes(x=treatment, y = pct_bf)
  ) +
  geom_boxplot(aes(fill = sex_m_f)) +
  labs(
    title = "Body Fat Proportion",
    x = "humidity treatment", 
    y = "percent body fat",
  ) +
  theme_classic()
bplot

```

```{r tickfat stats}
aov.tick <- aov(pct_bf ~ treatment+sex_m_f, data = df_calc)
summary(aov.tick)
```


